<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tester POS - Transbank</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="bg-light">

<div class="container py-5">
  <h1 class="text-center mb-4">Tester POS - Transbank</h1>

  <div class="row g-3">

    <div class="col-md-4">
      <button id="btnVender" class="btn btn-success w-100">Vender</button>
    </div>

    <div class="col-md-4">
      <button id="btnPoll" class="btn btn-primary w-100">Poll</button>
    </div>

    <div class="col-md-4">
      <button id="btnLoadKeys" class="btn btn-primary w-100">Load Keys</button>
    </div>

    <div class="col-md-4">
      <button id="btnCloseDay" class="btn btn-warning w-100">Close Day</button>
    </div>

    <div class="col-md-4">
      <button id="btnGetLastSale" class="btn btn-info w-100">Get Last Sale</button>
    </div>

    <div class="col-md-4">
      <button id="btnGetTotals" class="btn btn-info w-100">Get Totals</button>
    </div>

    <div class="col-md-4">
      <button id="btnDesconectar" class="btn btn-danger w-100">Desconectar POS</button>
    </div>

    <div class="col-md-4">
      <button id="btnReconnect" class="btn btn-secondary w-100">Reconectar POS</button>
    </div>

  </div>

  <div class="mt-5">
    <h4>Respuesta:</h4>
    <pre id="responseArea" class="bg-white p-3 border rounded" style="height: 300px; overflow: auto;"></pre>
  </div>

</div>

<script>
const baseURL = 'https://localhost:3000'; // Base URL del backend

// Helper para mostrar respuestas
function showResponse(data) {
  $('#responseArea').text(JSON.stringify(data, null, 2));
}

// Botón Vender
$('#btnVender').click(() => {
  const monto = prompt("Ingrese el monto a vender:", "1000");
  const ticket = prompt("Ingrese el número de ticket:", "12345");

  axios.post(`${baseURL}/api/payment`, { amount: parseInt(monto), ticketNumber: ticket })
    .then(res => showResponse(res.data))
    .catch(err => showResponse(err.response ? err.response.data : err));
});

// Botón Poll
$('#btnPoll').click(() => {
  axios.get(`${baseURL}/api/terminal/status`)
    .then(res => showResponse(res.data))
    .catch(err => showResponse(err.response ? err.response.data : err));
});

// Botón Load Keys
$('#btnLoadKeys').click(() => {
  axios.post(`${baseURL}/api/terminal/initialize`)
    .then(res => showResponse(res.data))
    .catch(err => showResponse(err.response ? err.response.data : err));
});

// Botón Close Day
$('#btnCloseDay').click(() => {
  axios.post(`${baseURL}/api/terminal/cierre-diario`, { printReport: true })
    .then(res => showResponse(res.data))
    .catch(err => showResponse(err.response ? err.response.data : err));
});

// Botón Get Last Sale
$('#btnGetLastSale').click(() => {
  axios.get(`${baseURL}/api/terminal/last-transaction`)
    .then(res => showResponse(res.data))
    .catch(err => showResponse(err.response ? err.response.data : err));
});

// Botón Get Totals
$('#btnGetTotals').click(() => {
  axios.get(`${baseURL}/api/terminal/status`)
    .then(res => showResponse(res.data))
    .catch(err => showResponse(err.response ? err.response.data : err));
});

// Botón Desconectar
$('#btnDesconectar').click(() => {
  axios.post(`${baseURL}/api/terminal/release-port`)
    .then(res => showResponse(res.data))
    .catch(err => showResponse(err.response ? err.response.data : err));
});

// Botón Reconectar
$('#btnReconnect').click(() => {
  axios.post(`${baseURL}/api/terminal/reconnect`)
    .then(res => showResponse(res.data))
    .catch(err => showResponse(err.response ? err.response.data : err));
});
</script>

</body>
</html>
